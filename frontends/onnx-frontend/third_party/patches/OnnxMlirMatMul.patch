diff --git a/src/Conversion/ONNXToStablehlo/Math/MatMul.cpp b/src/Conversion/ONNXToStablehlo/Math/MatMul.cpp
index 667860b7..2bc47f25 100644
--- a/src/Conversion/ONNXToStablehlo/Math/MatMul.cpp
+++ b/src/Conversion/ONNXToStablehlo/Math/MatMul.cpp
@@ -44,13 +44,13 @@ struct ONNXMatMulOpLoweringToStablehlo : public ConversionPattern {
     ShapedType outputShapedType = outputType.cast<ShapedType>();
     Type elementType = outputShapedType.getElementType();

-    if (llvm::any_of(outputShapedType.getShape(), ShapedType::isDynamic))
-      return rewriter.notifyMatchFailure(
-          op, "dynamic dimensions not supported");
-
     Value A(operandAdaptor.getA()), B(operandAdaptor.getB());
-    auto aRank = A.getType().cast<ShapedType>().getShape().size();
-    auto bRank = B.getType().cast<ShapedType>().getShape().size();
+    auto aType = A.getType().cast<ShapedType>();
+    auto bType = B.getType().cast<ShapedType>();
+    auto aOriginalShape = aType.getShape();
+    auto bOriginalShape = bType.getShape();
+    auto aRank = aOriginalShape.size();
+    auto bRank = bOriginalShape.size();
     // Size all the arrays to padded length.
     int paddedRank = std::max(aRank, bRank);
     paddedRank = std::max(paddedRank, 2);
@@ -60,6 +60,21 @@ struct ONNXMatMulOpLoweringToStablehlo : public ConversionPattern {
     llvm::BitVector bPadDims = shapeHelper.bPadDims;

     DimsExpr outputDims = shapeHelper.getOutputDims();
+
+    // Create shape computation helper
+    auto getDimValue = [&](Value shape, int64_t dim) -> Value {
+      return rewriter.create<shape::GetExtentOp>(loc, shape, dim);
+    };
+    // Helper to create shape tensor from dimensions
+    auto createShapeTensor = [&](const SmallVector<Value> &dims) -> Value {
+      Type shapeType = RankedTensorType::get(
+          {static_cast<int64_t>(dims.size())}, rewriter.getIndexType());
+      Value newShapeValue = rewriter.create<shape::FromExtentsOp>(loc, dims);
+      newShapeValue = rewriter.create<shape::ToExtentTensorOp>(
+          loc, shapeType, newShapeValue);
+      return newShapeValue;
+    };
+
     llvm::SmallVector<int64_t, 4> aShapeList;
     llvm::SmallVector<int64_t, 4> bShapeList;
     llvm::SmallVector<int64_t, 4> outputShapeList;
@@ -70,17 +85,65 @@ struct ONNXMatMulOpLoweringToStablehlo : public ConversionPattern {

     llvm::SmallVector<int64_t, 4> aShape;
     llvm::SmallVector<int64_t, 4> bShape;
+    SmallVector<Value> aShapeValues;
+    SmallVector<Value> bShapeValues;
+
+    Value aShapeValue = rewriter.create<shape::ShapeOfOp>(loc, A);
+    Value bShapeValue = rewriter.create<shape::ShapeOfOp>(loc, B);

     for (int64_t i = 0; i < paddedRank - 2; i++) {
-      aShape.push_back(getLiteralValue(outputDims[i]));
-      bShape.push_back(getLiteralValue(outputDims[i]));
+      if (outputDims[i].isLiteral()) {
+        int64_t dimValue = getLiteralValue(outputDims[i]);
+        aShape.push_back(dimValue);
+        bShape.push_back(dimValue);
+        aShapeValues.push_back(
+            rewriter.create<arith::ConstantIndexOp>(loc, dimValue));
+        bShapeValues.push_back(
+            rewriter.create<arith::ConstantIndexOp>(loc, dimValue));
+      } else {
+        aShape.push_back(ShapedType::kDynamic);
+        bShape.push_back(ShapedType::kDynamic);
+        if (!aPadDims[i]) {
+          aShapeValues.push_back(getDimValue(aShapeValue, i));
+          bShapeValues.push_back(getDimValue(aShapeValue, i));
+        } else {
+          aShapeValues.push_back(getDimValue(bShapeValue, i));
+          bShapeValues.push_back(getDimValue(bShapeValue, i));
+        }
+      }
     }
-    if (!aPadDims[paddedRank - 2])
+    if (!aPadDims[paddedRank - 2]) {
       aShape.push_back(aShapeList[paddedRank - 2]);
+      if (aDims[paddedRank - 2].isLiteral()) {
+        aShapeValues.push_back(rewriter.create<arith::ConstantIndexOp>(
+            loc, aShapeList[paddedRank - 2]));
+      } else {
+        aShapeValues.push_back(getDimValue(aShapeValue, paddedRank - 2));
+      }
+    }
     aShape.push_back(aShapeList[paddedRank - 1]);
+    if (aDims[paddedRank - 1].isLiteral()) {
+      aShapeValues.push_back(rewriter.create<arith::ConstantIndexOp>(
+          loc, aShapeList[paddedRank - 1]));
+    } else {
+      aShapeValues.push_back(getDimValue(aShapeValue, paddedRank - 1));
+    }
     bShape.push_back(bShapeList[paddedRank - 2]);
-    if (!bPadDims[paddedRank - 1])
+    if (bDims[paddedRank - 2].isLiteral()) {
+      bShapeValues.push_back(rewriter.create<arith::ConstantIndexOp>(
+          loc, bShapeList[paddedRank - 2]));
+    } else {
+      bShapeValues.push_back(getDimValue(bShapeValue, paddedRank - 2));
+    }
+    if (!bPadDims[paddedRank - 1]) {
       bShape.push_back(bShapeList[paddedRank - 1]);
+      if (bDims[paddedRank - 1].isLiteral()) {
+        bShapeValues.push_back(rewriter.create<arith::ConstantIndexOp>(
+            loc, bShapeList[paddedRank - 1]));
+      } else {
+        bShapeValues.push_back(getDimValue(bShapeValue, paddedRank - 1));
+      }
+    }

     Type outputAType = RankedTensorType::get(aShape, elementType);
     Type outputBType = RankedTensorType::get(bShape, elementType);
@@ -90,19 +153,51 @@ struct ONNXMatMulOpLoweringToStablehlo : public ConversionPattern {

     Value broadcastedA;
     {
-      SmallVector<int64_t, 4> broadcastDimensions =
-          llvm::to_vector<4>(llvm::seq<int64_t>(
-              paddedRank - oneDPadA - aRank, paddedRank - oneDPadA));
-      broadcastedA = rewriter.createOrFold<stablehlo::BroadcastInDimOp>(
-          loc, outputAType, A, rewriter.getI64VectorAttr(broadcastDimensions));
+      if (aShape.size() == aOriginalShape.size() &&
+          llvm::equal(aShape, aOriginalShape)) {
+        broadcastedA = A;
+      } else {
+        SmallVector<int64_t, 4> broadcastDimensions =
+            llvm::to_vector<4>(llvm::seq<int64_t>(
+                paddedRank - oneDPadA - aRank, paddedRank - oneDPadA));
+        // Check if we need dynamic broadcast
+        bool needsDynamicBroadcast = llvm::any_of(
+            aShape, [](int64_t dim) { return dim == ShapedType::kDynamic; });
+        if (needsDynamicBroadcast) {
+          Value broadcastedAShapeValue = createShapeTensor(aShapeValues);
+          broadcastedA =
+              rewriter.createOrFold<stablehlo::DynamicBroadcastInDimOp>(loc,
+                  outputAType, A, broadcastedAShapeValue,
+                  rewriter.getI64VectorAttr(broadcastDimensions));
+        } else {
+          broadcastedA = rewriter.createOrFold<stablehlo::BroadcastInDimOp>(loc,
+              outputAType, A, rewriter.getI64VectorAttr(broadcastDimensions));
+        }
+      }
     }
     Value broadcastedB;
     {
-      SmallVector<int64_t, 4> broadcastDimensions =
-          llvm::to_vector<4>(llvm::seq<int64_t>(
-              paddedRank - oneDPadB - bRank, paddedRank - oneDPadB));
-      broadcastedB = rewriter.createOrFold<stablehlo::BroadcastInDimOp>(
-          loc, outputBType, B, rewriter.getI64VectorAttr(broadcastDimensions));
+      if (bShape.size() == bOriginalShape.size() &&
+          llvm::equal(bShape, bOriginalShape)) {
+        broadcastedB = B;
+      } else {
+        SmallVector<int64_t, 4> broadcastDimensions =
+            llvm::to_vector<4>(llvm::seq<int64_t>(
+                paddedRank - oneDPadB - bRank, paddedRank - oneDPadB));
+        // Check if we need dynamic broadcast
+        bool needsDynamicBroadcast = llvm::any_of(
+            bShape, [](int64_t dim) { return dim == ShapedType::kDynamic; });
+        if (needsDynamicBroadcast) {
+          Value broadcastedBShapeValue = createShapeTensor(bShapeValues);
+          broadcastedB =
+              rewriter.createOrFold<stablehlo::DynamicBroadcastInDimOp>(loc,
+                  outputBType, B, broadcastedBShapeValue,
+                  rewriter.getI64VectorAttr(broadcastDimensions));
+        } else {
+          broadcastedB = rewriter.createOrFold<stablehlo::BroadcastInDimOp>(loc,
+              outputBType, B, rewriter.getI64VectorAttr(broadcastDimensions));
+        }
+      }
     }
     Value dotProduct;
     if (paddedRank > 2)
diff --git a/test/mlir/conversion/onnx_to_stablehlo/Math/MatMul.mlir b/test/mlir/conversion/onnx_to_stablehlo/Math/MatMul.mlir
index 65aa094b..f9448c4a 100644
--- a/test/mlir/conversion/onnx_to_stablehlo/Math/MatMul.mlir
+++ b/test/mlir/conversion/onnx_to_stablehlo/Math/MatMul.mlir
@@ -7,10 +7,8 @@ func.func @test_onnx_to_matmul2d(%arg0 : tensor<4x8xf32>, %arg1 : tensor<8x16xf3

 // CHECK-LABEL:  func.func @test_onnx_to_matmul2d
 // CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<4x8xf32>, [[PARAM_1_:%.+]]: tensor<8x16xf32>) -> tensor<4x16xf32> {
-// CHECK-DAG:       [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_0_]], dims = [0, 1] : (tensor<4x8xf32>) -> tensor<4x8xf32>
-// CHECK-DAG:       [[VAR_1_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [0, 1] : (tensor<8x16xf32>) -> tensor<8x16xf32>
-// CHECK:           [[VAR_2_:%.+]] = stablehlo.dot [[VAR_0_]], [[VAR_1_]] : (tensor<4x8xf32>, tensor<8x16xf32>) -> tensor<4x16xf32>
-// CHECK:           return [[VAR_2_]] : tensor<4x16xf32>
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot [[PARAM_0_]], [[PARAM_1_]] : (tensor<4x8xf32>, tensor<8x16xf32>) -> tensor<4x16xf32>
+// CHECK:           return [[VAR_0_]] : tensor<4x16xf32>
 // CHECK:         }

 // -----
@@ -22,10 +20,8 @@ func.func @test_onnx_to_matmul3d(%arg0 : tensor<100x4x8xf32>, %arg1 : tensor<100

 // CHECK-LABEL:  func.func @test_onnx_to_matmul3d
 // CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<100x4x8xf32>, [[PARAM_1_:%.+]]: tensor<100x8x16xf32>) -> tensor<100x4x16xf32> {
-// CHECK-DAG:       [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_0_]], dims = [0, 1, 2] : (tensor<100x4x8xf32>) -> tensor<100x4x8xf32>
-// CHECK-DAG:       [[VAR_1_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [0, 1, 2] : (tensor<100x8x16xf32>) -> tensor<100x8x16xf32>
-// CHECK:           [[VAR_2_:%.+]] = stablehlo.dot_general [[VAR_0_]], [[VAR_1_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<100x4x8xf32>, tensor<100x8x16xf32>) -> tensor<100x4x16xf32>
-// CHECK:           return [[VAR_2_]] : tensor<100x4x16xf32>
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot_general [[PARAM_0_]], [[PARAM_1_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<100x4x8xf32>, tensor<100x8x16xf32>) -> tensor<100x4x16xf32>
+// CHECK:           return [[VAR_0_]] : tensor<100x4x16xf32>
 // CHECK:         }

 // -----
@@ -37,10 +33,9 @@ func.func @test_onnx_to_matmul3dbcast(%arg0 : tensor<100x4x8xf32>, %arg1 : tenso

 // CHECK-LABEL:  func.func @test_onnx_to_matmul3dbcast
 // CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<100x4x8xf32>, [[PARAM_1_:%.+]]: tensor<8x16xf32>) -> tensor<100x4x16xf32> {
-// CHECK-DAG:       [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_0_]], dims = [0, 1, 2] : (tensor<100x4x8xf32>) -> tensor<100x4x8xf32>
-// CHECK-DAG:       [[VAR_1_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [1, 2] : (tensor<8x16xf32>) -> tensor<100x8x16xf32>
-// CHECK:           [[VAR_2_:%.+]] = stablehlo.dot_general [[VAR_0_]], [[VAR_1_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<100x4x8xf32>, tensor<100x8x16xf32>) -> tensor<100x4x16xf32>
-// CHECK:           return [[VAR_2_]] : tensor<100x4x16xf32>
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [1, 2] : (tensor<8x16xf32>) -> tensor<100x8x16xf32>
+// CHECK:           [[VAR_1_:%.+]] = stablehlo.dot_general [[PARAM_0_]], [[VAR_0_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<100x4x8xf32>, tensor<100x8x16xf32>) -> tensor<100x4x16xf32>
+// CHECK:           return [[VAR_1_]] : tensor<100x4x16xf32>
 // CHECK:         }

 // -----
@@ -52,10 +47,8 @@ func.func @test_onnx_1d(%arg0 : tensor<6xf32>, %arg1 : tensor<6xf32>) -> tensor<

 // CHECK-LABEL:  func.func @test_onnx_1d
 // CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<6xf32>, [[PARAM_1_:%.+]]: tensor<6xf32>) -> tensor<f32> {
-// CHECK-DAG:       [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_0_]], dims = [0] : (tensor<6xf32>) -> tensor<6xf32>
-// CHECK-DAG:       [[VAR_1_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [0] : (tensor<6xf32>) -> tensor<6xf32>
-// CHECK:           [[VAR_2_:%.+]] = stablehlo.dot [[VAR_0_]], [[VAR_1_]] : (tensor<6xf32>, tensor<6xf32>) -> tensor<f32>
-// CHECK:           return [[VAR_2_]] : tensor<f32>
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot [[PARAM_0_]], [[PARAM_1_]] : (tensor<6xf32>, tensor<6xf32>) -> tensor<f32>
+// CHECK:           return [[VAR_0_]] : tensor<f32>
 // CHECK:         }

 // -----
@@ -67,10 +60,8 @@ func.func @test_onnx_12d(%arg0 : tensor<6xf32>, %arg1 : tensor<6x2xf32>) -> tens

 // CHECK-LABEL:  func.func @test_onnx_12d
 // CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<6xf32>, [[PARAM_1_:%.+]]: tensor<6x2xf32>) -> tensor<2xf32> {
-// CHECK-DAG:       [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_0_]], dims = [0] : (tensor<6xf32>) -> tensor<6xf32>
-// CHECK-DAG:       [[VAR_1_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [0, 1] : (tensor<6x2xf32>) -> tensor<6x2xf32>
-// CHECK:           [[VAR_2_:%.+]] = stablehlo.dot [[VAR_0_]], [[VAR_1_]] : (tensor<6xf32>, tensor<6x2xf32>) -> tensor<2xf32>
-// CHECK:           return [[VAR_2_]] : tensor<2xf32>
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot [[PARAM_0_]], [[PARAM_1_]] : (tensor<6xf32>, tensor<6x2xf32>) -> tensor<2xf32>
+// CHECK:           return [[VAR_0_]] : tensor<2xf32>
 // CHECK:         }

 // -----
@@ -82,8 +73,67 @@ func.func @test_onnx_21d(%arg0 : tensor<2x6xf32>, %arg1 : tensor<6xf32>) -> tens

 // CHECK-LABEL:  func.func @test_onnx_21d
 // CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<2x6xf32>, [[PARAM_1_:%.+]]: tensor<6xf32>) -> tensor<2xf32> {
-// CHECK-DAG:       [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_0_]], dims = [0, 1] : (tensor<2x6xf32>) -> tensor<2x6xf32>
-// CHECK-DAG:       [[VAR_1_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [0] : (tensor<6xf32>) -> tensor<6xf32>
-// CHECK:           [[VAR_2_:%.+]] = stablehlo.dot [[VAR_0_]], [[VAR_1_]] : (tensor<2x6xf32>, tensor<6xf32>) -> tensor<2xf32>
-// CHECK:           return [[VAR_2_]] : tensor<2xf32>
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot [[PARAM_0_]], [[PARAM_1_]] : (tensor<2x6xf32>, tensor<6xf32>) -> tensor<2xf32>
+// CHECK:           return [[VAR_0_]] : tensor<2xf32>
+// CHECK:         }
+
+// -----
+
+func.func @test_matmul_dynamic_batch(%arg0: tensor<?x3x4xf32>, %arg1: tensor<?x4x5xf32>) -> tensor<?x3x5xf32> {
+  %0 = "onnx.MatMul"(%arg0, %arg1) : (tensor<?x3x4xf32>, tensor<?x4x5xf32>) -> tensor<?x3x5xf32>
+  return %0 : tensor<?x3x5xf32>
+}
+
+// CHECK-LABEL:  func.func @test_matmul_dynamic_batch
+// CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<?x3x4xf32>, [[PARAM_1_:%.+]]: tensor<?x4x5xf32>) -> tensor<?x3x5xf32> {
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot_general [[PARAM_0_]], [[PARAM_1_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<?x3x4xf32>, tensor<?x4x5xf32>) -> tensor<?x3x5xf32>
+// CHECK:           return [[VAR_0_]] : tensor<?x3x5xf32>
+// CHECK:         }
+
+// -----
+
+func.func @test_matmul_dynamic_2d(%arg0: tensor<?x?xf32>, %arg1: tensor<?x?xf32>) -> tensor<?x?xf32> {
+  %0 = "onnx.MatMul"(%arg0, %arg1) : (tensor<?x?xf32>, tensor<?x?xf32>) -> tensor<?x?xf32>
+  return %0 : tensor<?x?xf32>
+}
+
+// CHECK-LABEL:  func.func @test_matmul_dynamic_2d
+// CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<?x?xf32>, [[PARAM_1_:%.+]]: tensor<?x?xf32>) -> tensor<?x?xf32> {
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.dot [[PARAM_0_]], [[PARAM_1_]] : (tensor<?x?xf32>, tensor<?x?xf32>) -> tensor<?x?xf32>
+// CHECK:           return [[VAR_0_]] : tensor<?x?xf32>
+// CHECK:         }
+
+// -----
+
+func.func @test_matmul_broadcast_dynamic(%arg0: tensor<3x4xf32>, %arg1: tensor<?x4x5xf32>) -> tensor<?x3x5xf32> {
+  %0 = "onnx.MatMul"(%arg0, %arg1) : (tensor<3x4xf32>, tensor<?x4x5xf32>) -> tensor<?x3x5xf32>
+  return %0 : tensor<?x3x5xf32>
+}
+
+// CHECK-LABEL:  func.func @test_matmul_broadcast_dynamic
+// CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<3x4xf32>, [[PARAM_1_:%.+]]: tensor<?x4x5xf32>) -> tensor<?x3x5xf32> {
+// CHECK-DAG:       [[CST_0_:%.+]] = arith.constant 0 : index
+// CHECK-DAG:       [[CST_3_:%.+]] = arith.constant 3 : index
+// CHECK-DAG:       [[CST_4_:%.+]] = arith.constant 4 : index
+// CHECK-DAG:       [[VAR_0_:%.+]] = shape.shape_of [[PARAM_1_]] : tensor<?x4x5xf32> -> tensor<3xindex>
+// CHECK:           [[VAR_1_:%.+]] = shape.get_extent [[VAR_0_]], [[CST_0_]] : tensor<3xindex>, index -> index
+// CHECK:           [[VAR_2_:%.+]] = shape.from_extents [[VAR_1_]], [[CST_3_]], [[CST_4_]] : index, index, index
+// CHECK:           [[VAR_3_:%.+]] = shape.to_extent_tensor [[VAR_2_]] : !shape.shape -> tensor<3xindex>
+// CHECK:           [[VAR_4_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[PARAM_0_]], [[VAR_3_]], dims = [1, 2] : (tensor<3x4xf32>, tensor<3xindex>) -> tensor<?x3x4xf32>
+// CHECK:           [[VAR_5_:%.+]] = stablehlo.dot_general [[VAR_4_]], [[PARAM_1_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<?x3x4xf32>, tensor<?x4x5xf32>) -> tensor<?x3x5xf32>
+// CHECK:           return [[VAR_5_]] : tensor<?x3x5xf32>
+// CHECK:         }
+
+// -----
+
+func.func @test_matmul_mid_dynamic(%arg0: tensor<1x?x768xf16>, %arg1: tensor<768x3072xf16>) -> tensor<1x?x3072xf16> {
+  %0 = "onnx.MatMul"(%arg0, %arg1) : (tensor<1x?x768xf16>, tensor<768x3072xf16>) -> tensor<1x?x3072xf16>
+  return %0 : tensor<1x?x3072xf16>
+}
+
+// CHECK-LABEL:  func.func @test_matmul_mid_dynamic
+// CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<1x?x768xf16>, [[PARAM_1_:%.+]]: tensor<768x3072xf16>) -> tensor<1x?x3072xf16> {
+// CHECK:           [[VAR_0_:%.+]] = stablehlo.broadcast_in_dim [[PARAM_1_]], dims = [1, 2] : (tensor<768x3072xf16>) -> tensor<1x768x3072xf16>
+// CHECK:           [[VAR_1_:%.+]] = stablehlo.dot_general [[PARAM_0_]], [[VAR_0_]], batching_dims = [0] x [0], contracting_dims = [2] x [1] : (tensor<1x?x768xf16>, tensor<1x768x3072xf16>) -> tensor<1x?x3072xf16>
+// CHECK:           return [[VAR_1_]] : tensor<1x?x3072xf16>
 // CHECK:         }
diff --git a/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM-loop.mlir b/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM-loop.mlir
index c1e63c87..82565d22 100644
--- a/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM-loop.mlir
+++ b/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM-loop.mlir
@@ -83,76 +83,71 @@ func.func @test_lstm_loop(%arg0 : tensor<128x16x512xf32>, %arg1 : tensor<2x2048x
 // CHECK:             [[VAR_63_1_:%.+]] = stablehlo.reshape [[VAR_iterArg_]] : (tensor<1xi64>) -> tensor<i64>
 // CHECK:             [[VAR_64_1_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_63_1_]], [[VAR_17_]], [[VAR_17_]], sizes = [1, 16, 512] : (tensor<128x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
 // CHECK:             [[VAR_65_:%.+]] = stablehlo.dynamic_reshape [[VAR_64_1_]], [[VAR_5_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
-// CHECK-DAG:         [[VAR_66_:%.+]] = stablehlo.broadcast_in_dim [[VAR_65_]], dims = [0, 1] : (tensor<16x512xf32>) -> tensor<16x512xf32>
-// CHECK-DAG:         [[VAR_67_:%.+]] = stablehlo.broadcast_in_dim [[VAR_36_]], dims = [0, 1] : (tensor<512x1024xf32>) -> tensor<512x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_68_:%.+]] = stablehlo.dot [[VAR_66_]], [[VAR_67_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:         [[VAR_69_:%.+]] = stablehlo.broadcast_in_dim [[VAR_iterArg_1_]], dims = [0, 1] : (tensor<16x256xf32>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_70_:%.+]] = stablehlo.broadcast_in_dim [[VAR_37_]], dims = [0, 1] : (tensor<256x1024xf32>) -> tensor<256x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_71_:%.+]] = stablehlo.dot [[VAR_69_]], [[VAR_70_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:         [[VAR_72_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_68_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:             [[VAR_73_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_71_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:             [[VAR_74_:%.+]] = stablehlo.add [[VAR_72_]], [[VAR_73_]] : tensor<16x1024xf32>
-// CHECK-DAG:         [[VAR_75_:%.+]] = stablehlo.dynamic_slice [[VAR_74_]], [[VAR_17_]], [[VAR_17_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_76_:%.+]] = stablehlo.dynamic_slice [[VAR_74_]], [[VAR_17_]], [[VAR_13_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_77_:%.+]] = stablehlo.dynamic_slice [[VAR_74_]], [[VAR_17_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_78_:%.+]] = stablehlo.dynamic_slice [[VAR_74_]], [[VAR_17_]], [[VAR_11_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_79_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_75_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_80_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_44_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_81_:%.+]] = stablehlo.add [[VAR_79_]], [[VAR_80_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_82_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_81_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_83_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_48_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_66_:%.+]] = stablehlo.dot [[VAR_65_]], [[VAR_36_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-DAG:         [[VAR_67_:%.+]] = stablehlo.dot [[VAR_iterArg_1_]], [[VAR_37_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_68_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_66_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK-DAG:         [[VAR_69_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_67_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK:             [[VAR_70_:%.+]] = stablehlo.add [[VAR_68_]], [[VAR_69_]] : tensor<16x1024xf32>
+// CHECK-DAG:         [[VAR_71_:%.+]] = stablehlo.dynamic_slice [[VAR_70_]], [[VAR_17_]], [[VAR_17_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_72_:%.+]] = stablehlo.dynamic_slice [[VAR_70_]], [[VAR_17_]], [[VAR_13_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_73_:%.+]] = stablehlo.dynamic_slice [[VAR_70_]], [[VAR_17_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_74_:%.+]] = stablehlo.dynamic_slice [[VAR_70_]], [[VAR_17_]], [[VAR_11_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_75_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_71_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_76_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_44_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_77_:%.+]] = stablehlo.add [[VAR_75_]], [[VAR_76_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_78_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_77_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_79_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_48_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_80_:%.+]] = stablehlo.add [[VAR_78_]], [[VAR_79_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_81_:%.+]] = stablehlo.logistic [[VAR_80_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_82_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_73_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_83_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_46_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:             [[VAR_84_:%.+]] = stablehlo.add [[VAR_82_]], [[VAR_83_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_85_:%.+]] = stablehlo.logistic [[VAR_84_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_86_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_77_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_87_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_46_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_88_:%.+]] = stablehlo.add [[VAR_86_]], [[VAR_87_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_89_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_88_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_90_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_50_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_85_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_84_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_86_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_50_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_87_:%.+]] = stablehlo.add [[VAR_85_]], [[VAR_86_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_88_:%.+]] = stablehlo.logistic [[VAR_87_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_89_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_74_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_90_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_47_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:             [[VAR_91_:%.+]] = stablehlo.add [[VAR_89_]], [[VAR_90_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_92_:%.+]] = stablehlo.logistic [[VAR_91_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_93_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_78_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_94_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_47_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_95_:%.+]] = stablehlo.add [[VAR_93_]], [[VAR_94_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_96_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_95_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_97_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_51_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_98_:%.+]] = stablehlo.add [[VAR_96_]], [[VAR_97_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_99_:%.+]] = stablehlo.tanh [[VAR_98_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_100_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_92_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_101_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_2_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_102_:%.+]] = stablehlo.multiply [[VAR_100_]], [[VAR_101_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_103_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_85_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_104_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_99_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_105_:%.+]] = stablehlo.multiply [[VAR_103_]], [[VAR_104_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_106_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_102_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_107_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_105_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_108_:%.+]] = stablehlo.add [[VAR_106_]], [[VAR_107_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_109_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_76_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_110_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_45_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_111_:%.+]] = stablehlo.add [[VAR_109_]], [[VAR_110_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_112_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_111_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_113_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_49_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_114_:%.+]] = stablehlo.add [[VAR_112_]], [[VAR_113_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_115_:%.+]] = stablehlo.logistic [[VAR_114_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_116_:%.+]] = stablehlo.tanh [[VAR_108_]] : tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_117_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_115_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_118_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_116_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_119_:%.+]] = stablehlo.multiply [[VAR_117_]], [[VAR_118_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_120_:%.+]] = stablehlo.dynamic_reshape [[VAR_119_]], [[VAR_3_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
-// CHECK-DAG:         [[VAR_121_:%.+]] = stablehlo.dynamic_reshape [[VAR_iterArg_]], [[VAR_2_]] : (tensor<1xi64>, tensor<2xindex>) -> tensor<1x1xi64>
-// CHECK:             [[VAR_122_:%.+]] = "stablehlo.scatter"([[VAR_iterArg_0_]], [[VAR_121_]], [[VAR_120_]]) ({
+// CHECK-DAG:         [[VAR_92_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_91_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_93_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_51_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_94_:%.+]] = stablehlo.add [[VAR_92_]], [[VAR_93_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_95_:%.+]] = stablehlo.tanh [[VAR_94_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_96_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_88_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_97_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_2_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_98_:%.+]] = stablehlo.multiply [[VAR_96_]], [[VAR_97_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_99_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_81_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_100_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_95_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_101_:%.+]] = stablehlo.multiply [[VAR_99_]], [[VAR_100_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_102_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_98_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_103_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_101_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_104_:%.+]] = stablehlo.add [[VAR_102_]], [[VAR_103_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_105_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_72_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_106_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_45_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_107_:%.+]] = stablehlo.add [[VAR_105_]], [[VAR_106_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_108_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_107_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_109_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_49_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_110_:%.+]] = stablehlo.add [[VAR_108_]], [[VAR_109_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_111_:%.+]] = stablehlo.logistic [[VAR_110_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_112_:%.+]] = stablehlo.tanh [[VAR_104_]] : tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_113_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_111_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_114_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_112_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_115_:%.+]] = stablehlo.multiply [[VAR_113_]], [[VAR_114_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_116_:%.+]] = stablehlo.dynamic_reshape [[VAR_115_]], [[VAR_3_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
+// CHECK-DAG:         [[VAR_117_:%.+]] = stablehlo.dynamic_reshape [[VAR_iterArg_]], [[VAR_2_]] : (tensor<1xi64>, tensor<2xindex>) -> tensor<1x1xi64>
+// CHECK:             [[VAR_118_:%.+]] = "stablehlo.scatter"([[VAR_iterArg_0_]], [[VAR_117_]], [[VAR_116_]]) ({
 // CHECK:             ^bb0([[arg4_:%.+]]: tensor<f32>, [[arg5_:%.+]]: tensor<f32>):
 // CHECK:               stablehlo.return [[arg5_]] : tensor<f32>
 // CHECK:             }) {indices_are_sorted = false, scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1, 2, 3], inserted_window_dims = [0], scatter_dims_to_operand_dims = [0], index_vector_dim = 1>, unique_indices = false} : (tensor<128x1x16x256xf32>, tensor<1x1xi64>, tensor<1x1x16x256xf32>) -> tensor<128x1x16x256xf32>
-// CHECK-DAG:         [[VAR_123_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
-// CHECK-DAG:         [[VAR_124_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_10_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
-// CHECK:             [[VAR_125_:%.+]] = stablehlo.add [[VAR_123_]], [[VAR_124_]] : tensor<1xi64>
-// CHECK:             stablehlo.return [[VAR_125_]], [[VAR_122_]], [[VAR_119_]], [[VAR_108_]] : tensor<1xi64>, tensor<128x1x16x256xf32>, tensor<16x256xf32>, tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_119_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
+// CHECK-DAG:         [[VAR_120_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_10_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
+// CHECK:             [[VAR_121_:%.+]] = stablehlo.add [[VAR_119_]], [[VAR_120_]] : tensor<1xi64>
+// CHECK:             stablehlo.return [[VAR_121_]], [[VAR_118_]], [[VAR_115_]], [[VAR_104_]] : tensor<1xi64>, tensor<128x1x16x256xf32>, tensor<16x256xf32>, tensor<16x256xf32>
 // CHECK:           }
 // CHECK:           [[VAR_61_:%.+]]:4 = stablehlo.while([[VAR_iterArg_1_:%.+]] = [[VAR_9_]], [[VAR_iterArg_0_1_:%.+]] = [[VAR_16_]], [[VAR_iterArg_1_1_:%.+]] = [[VAR_25_]], [[VAR_iterArg_2_1_:%.+]] = [[VAR_27_]]) : tensor<1xi64>, tensor<128x1x16x256xf32>, tensor<16x256xf32>, tensor<16x256xf32>
 // CHECK:            cond {
@@ -163,76 +158,71 @@ func.func @test_lstm_loop(%arg0 : tensor<128x16x512xf32>, %arg1 : tensor<2x2048x
 // CHECK:             [[VAR_63_3_:%.+]] = stablehlo.reshape [[VAR_iterArg_1_]] : (tensor<1xi64>) -> tensor<i64>
 // CHECK:             [[VAR_64_3_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_63_3_]], [[VAR_17_]], [[VAR_17_]], sizes = [1, 16, 512] : (tensor<128x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
 // CHECK:             [[VAR_65_1_:%.+]] = stablehlo.dynamic_reshape [[VAR_64_3_]], [[VAR_5_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
-// CHECK-DAG:         [[VAR_66_1_:%.+]] = stablehlo.broadcast_in_dim [[VAR_65_1_]], dims = [0, 1] : (tensor<16x512xf32>) -> tensor<16x512xf32>
-// CHECK-DAG:         [[VAR_67_1_:%.+]] = stablehlo.broadcast_in_dim [[VAR_38_]], dims = [0, 1] : (tensor<512x1024xf32>) -> tensor<512x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_68_1_:%.+]] = stablehlo.dot [[VAR_66_1_]], [[VAR_67_1_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:         [[VAR_69_1_:%.+]] = stablehlo.broadcast_in_dim [[VAR_iterArg_1_1_]], dims = [0, 1] : (tensor<16x256xf32>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_70_1_:%.+]] = stablehlo.broadcast_in_dim [[VAR_39_]], dims = [0, 1] : (tensor<256x1024xf32>) -> tensor<256x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_71_1_:%.+]] = stablehlo.dot [[VAR_69_1_]], [[VAR_70_1_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:         [[VAR_72_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_68_1_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:             [[VAR_73_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_71_1_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:             [[VAR_74_1_:%.+]] = stablehlo.add [[VAR_72_1_]], [[VAR_73_1_]] : tensor<16x1024xf32>
-// CHECK-DAG:         [[VAR_75_1_:%.+]] = stablehlo.dynamic_slice [[VAR_74_1_]], [[VAR_17_]], [[VAR_17_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_76_1_:%.+]] = stablehlo.dynamic_slice [[VAR_74_1_]], [[VAR_17_]], [[VAR_13_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_77_1_:%.+]] = stablehlo.dynamic_slice [[VAR_74_1_]], [[VAR_17_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_78_1_:%.+]] = stablehlo.dynamic_slice [[VAR_74_1_]], [[VAR_17_]], [[VAR_11_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_79_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_75_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_80_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_52_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_81_1_:%.+]] = stablehlo.add [[VAR_79_1_]], [[VAR_80_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_82_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_81_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_83_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_56_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_66_1_:%.+]] = stablehlo.dot [[VAR_65_1_]], [[VAR_38_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-DAG:         [[VAR_67_1_:%.+]] = stablehlo.dot [[VAR_iterArg_1_1_]], [[VAR_39_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_68_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_66_1_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK-DAG:         [[VAR_69_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_67_1_]], [[VAR_4_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK:             [[VAR_70_1_:%.+]] = stablehlo.add [[VAR_68_1_]], [[VAR_69_1_]] : tensor<16x1024xf32>
+// CHECK-DAG:         [[VAR_71_1_:%.+]] = stablehlo.dynamic_slice [[VAR_70_1_]], [[VAR_17_]], [[VAR_17_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_72_1_:%.+]] = stablehlo.dynamic_slice [[VAR_70_1_]], [[VAR_17_]], [[VAR_13_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_73_1_:%.+]] = stablehlo.dynamic_slice [[VAR_70_1_]], [[VAR_17_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_74_1_:%.+]] = stablehlo.dynamic_slice [[VAR_70_1_]], [[VAR_17_]], [[VAR_11_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_75_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_71_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_76_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_52_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_77_1_:%.+]] = stablehlo.add [[VAR_75_1_]], [[VAR_76_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_78_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_77_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_79_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_56_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_80_1_:%.+]] = stablehlo.add [[VAR_78_1_]], [[VAR_79_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_81_1_:%.+]] = stablehlo.logistic [[VAR_80_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_82_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_73_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_83_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_54_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:             [[VAR_84_1_:%.+]] = stablehlo.add [[VAR_82_1_]], [[VAR_83_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_85_1_:%.+]] = stablehlo.logistic [[VAR_84_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_86_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_77_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_87_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_54_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_88_1_:%.+]] = stablehlo.add [[VAR_86_1_]], [[VAR_87_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_89_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_88_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_90_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_58_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_85_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_84_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_86_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_58_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_87_1_:%.+]] = stablehlo.add [[VAR_85_1_]], [[VAR_86_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_88_1_:%.+]] = stablehlo.logistic [[VAR_87_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_89_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_74_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_90_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_55_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:             [[VAR_91_1_:%.+]] = stablehlo.add [[VAR_89_1_]], [[VAR_90_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_92_1_:%.+]] = stablehlo.logistic [[VAR_91_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_93_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_78_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_94_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_55_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_95_1_:%.+]] = stablehlo.add [[VAR_93_1_]], [[VAR_94_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_96_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_95_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_97_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_59_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_98_1_:%.+]] = stablehlo.add [[VAR_96_1_]], [[VAR_97_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_99_1_:%.+]] = stablehlo.tanh [[VAR_98_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_100_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_92_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_101_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_2_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_102_1_:%.+]] = stablehlo.multiply [[VAR_100_1_]], [[VAR_101_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_103_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_85_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_104_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_99_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_105_1_:%.+]] = stablehlo.multiply [[VAR_103_1_]], [[VAR_104_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_106_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_102_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_107_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_105_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_108_1_:%.+]] = stablehlo.add [[VAR_106_1_]], [[VAR_107_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_109_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_76_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_110_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_53_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_111_1_:%.+]] = stablehlo.add [[VAR_109_1_]], [[VAR_110_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_112_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_111_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_113_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_57_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_114_1_:%.+]] = stablehlo.add [[VAR_112_1_]], [[VAR_113_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_115_1_:%.+]] = stablehlo.logistic [[VAR_114_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_116_1_:%.+]] = stablehlo.tanh [[VAR_108_1_]] : tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:         [[VAR_117_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_115_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_118_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_116_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:             [[VAR_119_1_:%.+]] = stablehlo.multiply [[VAR_117_1_]], [[VAR_118_1_]] : tensor<16x256xf32>
-// CHECK-DAG:         [[VAR_120_1_:%.+]] = stablehlo.dynamic_reshape [[VAR_119_1_]], [[VAR_3_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
-// CHECK-DAG:         [[VAR_121_1_:%.+]] = stablehlo.dynamic_reshape [[VAR_iterArg_1_]], [[VAR_2_]] : (tensor<1xi64>, tensor<2xindex>) -> tensor<1x1xi64>
-// CHECK:             [[VAR_122_1_:%.+]] = "stablehlo.scatter"([[VAR_iterArg_0_1_]], [[VAR_121_1_]], [[VAR_120_1_]]) ({
-// CHECK:             ^bb0([[arg4_:%.+]]: tensor<f32>, [[arg5_:%.+]]: tensor<f32>):
+// CHECK-DAG:         [[VAR_92_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_91_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_93_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_59_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_94_1_:%.+]] = stablehlo.add [[VAR_92_1_]], [[VAR_93_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_95_1_:%.+]] = stablehlo.tanh [[VAR_94_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_96_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_88_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_97_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_2_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_98_1_:%.+]] = stablehlo.multiply [[VAR_96_1_]], [[VAR_97_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_99_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_81_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_100_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_95_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_101_1_:%.+]] = stablehlo.multiply [[VAR_99_1_]], [[VAR_100_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_102_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_98_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_103_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_101_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_104_1_:%.+]] = stablehlo.add [[VAR_102_1_]], [[VAR_103_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_105_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_72_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_106_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_53_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_107_1_:%.+]] = stablehlo.add [[VAR_105_1_]], [[VAR_106_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_108_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_107_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_109_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_57_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_110_1_:%.+]] = stablehlo.add [[VAR_108_1_]], [[VAR_109_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_111_1_:%.+]] = stablehlo.logistic [[VAR_110_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_112_1_:%.+]] = stablehlo.tanh [[VAR_104_1_]] : tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:         [[VAR_113_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_111_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_114_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_112_1_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:             [[VAR_115_1_:%.+]] = stablehlo.multiply [[VAR_113_1_]], [[VAR_114_1_]] : tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_116_1_:%.+]] = stablehlo.dynamic_reshape [[VAR_115_1_]], [[VAR_3_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
+// CHECK-DAG:         [[VAR_117_1_:%.+]] = stablehlo.dynamic_reshape [[VAR_iterArg_1_]], [[VAR_2_]] : (tensor<1xi64>, tensor<2xindex>) -> tensor<1x1xi64>
+// CHECK:             [[VAR_118_1_:%.+]] = "stablehlo.scatter"([[VAR_iterArg_0_1_]], [[VAR_117_1_]], [[VAR_116_1_]]) ({
+// CHECK:             ^bb0([[arg4_]]: tensor<f32>, [[arg5_]]: tensor<f32>):
 // CHECK:               stablehlo.return [[arg5_]] : tensor<f32>
 // CHECK:             }) {indices_are_sorted = false, scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1, 2, 3], inserted_window_dims = [0], scatter_dims_to_operand_dims = [0], index_vector_dim = 1>, unique_indices = false} : (tensor<128x1x16x256xf32>, tensor<1x1xi64>, tensor<1x1x16x256xf32>) -> tensor<128x1x16x256xf32>
-// CHECK-DAG:         [[VAR_123_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_1_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
-// CHECK-DAG:         [[VAR_124_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_10_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
-// CHECK:             [[VAR_125_1_:%.+]] = stablehlo.subtract [[VAR_123_1_]], [[VAR_124_1_]] : tensor<1xi64>
-// CHECK:             stablehlo.return [[VAR_125_1_]], [[VAR_122_1_]], [[VAR_119_1_]], [[VAR_108_1_]] : tensor<1xi64>, tensor<128x1x16x256xf32>, tensor<16x256xf32>, tensor<16x256xf32>
+// CHECK-DAG:         [[VAR_119_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_iterArg_1_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
+// CHECK-DAG:         [[VAR_120_1_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_10_]], [[VAR_1_]], dims = [0] : (tensor<1xi64>, tensor<1xindex>) -> tensor<1xi64>
+// CHECK:             [[VAR_121_1_:%.+]] = stablehlo.subtract [[VAR_119_1_]], [[VAR_120_1_]] : tensor<1xi64>
+// CHECK:             stablehlo.return [[VAR_121_1_]], [[VAR_118_1_]], [[VAR_115_1_]], [[VAR_104_1_]] : tensor<1xi64>, tensor<128x1x16x256xf32>, tensor<16x256xf32>, tensor<16x256xf32>
 // CHECK:           }
 // CHECK:           [[VAR_62_:%.+]] = stablehlo.concatenate [[VAR_60_]]#1, [[VAR_61_]]#1, dim = 1 : (tensor<128x1x16x256xf32>, tensor<128x1x16x256xf32>) -> tensor<128x2x16x256xf32>
 // CHECK:           return [[VAR_62_]] : tensor<128x2x16x256xf32>
diff --git a/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM.mlir b/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM.mlir
index ee62fd81..8c81ce07 100644
--- a/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM.mlir
+++ b/test/mlir/conversion/onnx_to_stablehlo/RNN/LSTM.mlir
@@ -72,262 +72,242 @@ func.func @test_lstm(%arg0 : tensor<2x16x512xf32>, %arg1 : tensor<2x2048xf32>, %
 // CHECK-DAG:       [[VAR_55_:%.+]] = stablehlo.reshape [[VAR_13_]] : (tensor<1xi64>) -> tensor<i64>
 // CHECK:           [[VAR_56_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_55_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
 // CHECK:           [[VAR_57_:%.+]] = stablehlo.dynamic_reshape [[VAR_56_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_58_:%.+]] = stablehlo.broadcast_in_dim [[VAR_57_]], dims = [0, 1] : (tensor<16x512xf32>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_59_:%.+]] = stablehlo.broadcast_in_dim [[VAR_31_]], dims = [0, 1] : (tensor<512x1024xf32>) -> tensor<512x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_60_:%.+]] = stablehlo.dot [[VAR_58_]], [[VAR_59_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_61_:%.+]] = stablehlo.broadcast_in_dim [[VAR_16_]], dims = [0, 1] : (tensor<16x256xf32>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_62_:%.+]] = stablehlo.broadcast_in_dim [[VAR_32_]], dims = [0, 1] : (tensor<256x1024xf32>) -> tensor<256x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_63_:%.+]] = stablehlo.dot [[VAR_61_]], [[VAR_62_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_64_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_60_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_65_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_63_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_66_:%.+]] = stablehlo.add [[VAR_64_]], [[VAR_65_]] : tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_67_:%.+]] = stablehlo.dynamic_slice [[VAR_66_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_68_:%.+]] = stablehlo.dynamic_slice [[VAR_66_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_69_:%.+]] = stablehlo.dynamic_slice [[VAR_66_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_70_:%.+]] = stablehlo.dynamic_slice [[VAR_66_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_71_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_67_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_72_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_39_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_73_:%.+]] = stablehlo.add [[VAR_71_]], [[VAR_72_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_74_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_73_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_75_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_43_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_58_:%.+]] = stablehlo.dot [[VAR_57_]], [[VAR_31_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_59_:%.+]] = stablehlo.dot [[VAR_16_]], [[VAR_32_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_60_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_58_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_61_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_59_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK:           [[VAR_62_:%.+]] = stablehlo.add [[VAR_60_]], [[VAR_61_]] : tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_63_:%.+]] = stablehlo.dynamic_slice [[VAR_62_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_64_:%.+]] = stablehlo.dynamic_slice [[VAR_62_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_65_:%.+]] = stablehlo.dynamic_slice [[VAR_62_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_66_:%.+]] = stablehlo.dynamic_slice [[VAR_62_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_67_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_63_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_68_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_39_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_69_:%.+]] = stablehlo.add [[VAR_67_]], [[VAR_68_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_70_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_69_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_71_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_43_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_72_:%.+]] = stablehlo.add [[VAR_70_]], [[VAR_71_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_73_:%.+]] = stablehlo.logistic [[VAR_72_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_74_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_65_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_75_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_41_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:           [[VAR_76_:%.+]] = stablehlo.add [[VAR_74_]], [[VAR_75_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_77_:%.+]] = stablehlo.logistic [[VAR_76_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_78_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_69_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_79_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_41_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_80_:%.+]] = stablehlo.add [[VAR_78_]], [[VAR_79_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_81_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_80_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_82_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_45_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_77_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_76_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_78_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_45_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_79_:%.+]] = stablehlo.add [[VAR_77_]], [[VAR_78_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_80_:%.+]] = stablehlo.logistic [[VAR_79_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_81_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_66_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_82_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_42_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:           [[VAR_83_:%.+]] = stablehlo.add [[VAR_81_]], [[VAR_82_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_84_:%.+]] = stablehlo.logistic [[VAR_83_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_85_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_70_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_86_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_42_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_87_:%.+]] = stablehlo.add [[VAR_85_]], [[VAR_86_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_88_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_87_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_89_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_46_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_90_:%.+]] = stablehlo.add [[VAR_88_]], [[VAR_89_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_91_:%.+]] = stablehlo.tanh [[VAR_90_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_92_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_84_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_93_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_18_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_94_:%.+]] = stablehlo.multiply [[VAR_92_]], [[VAR_93_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_95_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_77_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_96_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_91_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_97_:%.+]] = stablehlo.multiply [[VAR_95_]], [[VAR_96_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_98_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_94_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_99_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_97_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_100_:%.+]] = stablehlo.add [[VAR_98_]], [[VAR_99_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_101_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_68_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_102_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_40_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_103_:%.+]] = stablehlo.add [[VAR_101_]], [[VAR_102_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_104_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_103_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_105_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_44_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_106_:%.+]] = stablehlo.add [[VAR_104_]], [[VAR_105_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_107_:%.+]] = stablehlo.logistic [[VAR_106_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_108_:%.+]] = stablehlo.tanh [[VAR_100_]] : tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_109_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_107_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_110_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_108_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_111_:%.+]] = stablehlo.multiply [[VAR_109_]], [[VAR_110_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_112_:%.+]] = stablehlo.dynamic_reshape [[VAR_111_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
-// CHECK-DAG:       [[VAR_113_:%.+]] = stablehlo.reshape [[VAR_7_]] : (tensor<1xi64>) -> tensor<i64>
-// CHECK:           [[VAR_114_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_113_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
-// CHECK:           [[VAR_115_:%.+]] = stablehlo.dynamic_reshape [[VAR_114_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_116_:%.+]] = stablehlo.broadcast_in_dim [[VAR_115_]], dims = [0, 1] : (tensor<16x512xf32>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_117_:%.+]] = stablehlo.broadcast_in_dim [[VAR_31_]], dims = [0, 1] : (tensor<512x1024xf32>) -> tensor<512x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_118_:%.+]] = stablehlo.dot [[VAR_116_]], [[VAR_117_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_119_:%.+]] = stablehlo.broadcast_in_dim [[VAR_111_]], dims = [0, 1] : (tensor<16x256xf32>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_120_:%.+]] = stablehlo.broadcast_in_dim [[VAR_32_]], dims = [0, 1] : (tensor<256x1024xf32>) -> tensor<256x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_121_:%.+]] = stablehlo.dot [[VAR_119_]], [[VAR_120_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_122_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_118_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_123_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_121_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_124_:%.+]] = stablehlo.add [[VAR_122_]], [[VAR_123_]] : tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_125_:%.+]] = stablehlo.dynamic_slice [[VAR_124_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_126_:%.+]] = stablehlo.dynamic_slice [[VAR_124_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_127_:%.+]] = stablehlo.dynamic_slice [[VAR_124_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_128_:%.+]] = stablehlo.dynamic_slice [[VAR_124_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_129_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_125_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_130_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_39_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_131_:%.+]] = stablehlo.add [[VAR_129_]], [[VAR_130_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_132_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_131_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_133_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_43_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_134_:%.+]] = stablehlo.add [[VAR_132_]], [[VAR_133_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_135_:%.+]] = stablehlo.logistic [[VAR_134_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_136_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_127_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_137_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_41_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_138_:%.+]] = stablehlo.add [[VAR_136_]], [[VAR_137_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_139_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_138_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_140_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_45_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_141_:%.+]] = stablehlo.add [[VAR_139_]], [[VAR_140_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_142_:%.+]] = stablehlo.logistic [[VAR_141_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_143_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_128_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_144_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_42_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_145_:%.+]] = stablehlo.add [[VAR_143_]], [[VAR_144_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_146_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_145_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_147_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_46_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_148_:%.+]] = stablehlo.add [[VAR_146_]], [[VAR_147_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_149_:%.+]] = stablehlo.tanh [[VAR_148_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_150_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_142_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_151_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_100_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_152_:%.+]] = stablehlo.multiply [[VAR_150_]], [[VAR_151_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_153_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_135_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_154_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_149_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_155_:%.+]] = stablehlo.multiply [[VAR_153_]], [[VAR_154_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_156_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_152_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_157_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_155_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_158_:%.+]] = stablehlo.add [[VAR_156_]], [[VAR_157_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_159_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_126_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_160_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_40_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_161_:%.+]] = stablehlo.add [[VAR_159_]], [[VAR_160_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_162_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_161_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_163_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_44_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_164_:%.+]] = stablehlo.add [[VAR_162_]], [[VAR_163_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_165_:%.+]] = stablehlo.logistic [[VAR_164_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_166_:%.+]] = stablehlo.tanh [[VAR_158_]] : tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_167_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_165_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_168_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_166_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_169_:%.+]] = stablehlo.multiply [[VAR_167_]], [[VAR_168_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_170_:%.+]] = stablehlo.dynamic_reshape [[VAR_169_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
-// CHECK-DAG:       [[VAR_171_:%.+]] = stablehlo.reshape [[VAR_7_]] : (tensor<1xi64>) -> tensor<i64>
-// CHECK:           [[VAR_172_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_171_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
-// CHECK:           [[VAR_173_:%.+]] = stablehlo.dynamic_reshape [[VAR_172_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_174_:%.+]] = stablehlo.broadcast_in_dim [[VAR_173_]], dims = [0, 1] : (tensor<16x512xf32>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_175_:%.+]] = stablehlo.broadcast_in_dim [[VAR_33_]], dims = [0, 1] : (tensor<512x1024xf32>) -> tensor<512x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_176_:%.+]] = stablehlo.dot [[VAR_174_]], [[VAR_175_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_177_:%.+]] = stablehlo.broadcast_in_dim [[VAR_20_]], dims = [0, 1] : (tensor<16x256xf32>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_178_:%.+]] = stablehlo.broadcast_in_dim [[VAR_34_]], dims = [0, 1] : (tensor<256x1024xf32>) -> tensor<256x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_179_:%.+]] = stablehlo.dot [[VAR_177_]], [[VAR_178_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_180_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_176_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_181_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_179_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_182_:%.+]] = stablehlo.add [[VAR_180_]], [[VAR_181_]] : tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_183_:%.+]] = stablehlo.dynamic_slice [[VAR_182_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_184_:%.+]] = stablehlo.dynamic_slice [[VAR_182_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_185_:%.+]] = stablehlo.dynamic_slice [[VAR_182_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_186_:%.+]] = stablehlo.dynamic_slice [[VAR_182_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_187_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_183_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_188_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_47_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_189_:%.+]] = stablehlo.add [[VAR_187_]], [[VAR_188_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_190_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_189_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_191_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_51_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_192_:%.+]] = stablehlo.add [[VAR_190_]], [[VAR_191_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_193_:%.+]] = stablehlo.logistic [[VAR_192_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_194_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_185_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_195_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_49_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_196_:%.+]] = stablehlo.add [[VAR_194_]], [[VAR_195_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_197_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_196_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_198_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_53_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_199_:%.+]] = stablehlo.add [[VAR_197_]], [[VAR_198_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_200_:%.+]] = stablehlo.logistic [[VAR_199_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_201_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_186_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_202_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_50_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_203_:%.+]] = stablehlo.add [[VAR_201_]], [[VAR_202_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_204_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_203_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_205_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_54_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_206_:%.+]] = stablehlo.add [[VAR_204_]], [[VAR_205_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_207_:%.+]] = stablehlo.tanh [[VAR_206_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_208_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_200_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_209_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_22_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_210_:%.+]] = stablehlo.multiply [[VAR_208_]], [[VAR_209_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_211_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_193_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_212_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_207_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_213_:%.+]] = stablehlo.multiply [[VAR_211_]], [[VAR_212_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_214_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_210_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_215_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_213_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_216_:%.+]] = stablehlo.add [[VAR_214_]], [[VAR_215_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_217_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_184_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_218_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_48_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_219_:%.+]] = stablehlo.add [[VAR_217_]], [[VAR_218_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_220_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_219_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_221_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_52_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_222_:%.+]] = stablehlo.add [[VAR_220_]], [[VAR_221_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_223_:%.+]] = stablehlo.logistic [[VAR_222_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_224_:%.+]] = stablehlo.tanh [[VAR_216_]] : tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_225_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_223_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_226_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_224_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_227_:%.+]] = stablehlo.multiply [[VAR_225_]], [[VAR_226_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_228_:%.+]] = stablehlo.dynamic_reshape [[VAR_227_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
-// CHECK-DAG:       [[VAR_229_:%.+]] = stablehlo.reshape [[VAR_13_]] : (tensor<1xi64>) -> tensor<i64>
-// CHECK:           [[VAR_230_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_229_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
-// CHECK:           [[VAR_231_:%.+]] = stablehlo.dynamic_reshape [[VAR_230_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_232_:%.+]] = stablehlo.broadcast_in_dim [[VAR_231_]], dims = [0, 1] : (tensor<16x512xf32>) -> tensor<16x512xf32>
-// CHECK-DAG:       [[VAR_233_:%.+]] = stablehlo.broadcast_in_dim [[VAR_33_]], dims = [0, 1] : (tensor<512x1024xf32>) -> tensor<512x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_234_:%.+]] = stablehlo.dot [[VAR_232_]], [[VAR_233_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_235_:%.+]] = stablehlo.broadcast_in_dim [[VAR_227_]], dims = [0, 1] : (tensor<16x256xf32>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_236_:%.+]] = stablehlo.broadcast_in_dim [[VAR_34_]], dims = [0, 1] : (tensor<256x1024xf32>) -> tensor<256x1024xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_237_:%.+]] = stablehlo.dot [[VAR_235_]], [[VAR_236_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_238_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_234_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_239_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_237_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
-// CHECK:           [[VAR_240_:%.+]] = stablehlo.add [[VAR_238_]], [[VAR_239_]] : tensor<16x1024xf32>
-// CHECK-DAG:       [[VAR_241_:%.+]] = stablehlo.dynamic_slice [[VAR_240_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_242_:%.+]] = stablehlo.dynamic_slice [[VAR_240_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_243_:%.+]] = stablehlo.dynamic_slice [[VAR_240_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_244_:%.+]] = stablehlo.dynamic_slice [[VAR_240_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_245_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_241_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_246_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_47_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_247_:%.+]] = stablehlo.add [[VAR_245_]], [[VAR_246_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_248_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_247_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_249_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_51_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_250_:%.+]] = stablehlo.add [[VAR_248_]], [[VAR_249_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_251_:%.+]] = stablehlo.logistic [[VAR_250_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_252_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_243_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_253_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_49_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_254_:%.+]] = stablehlo.add [[VAR_252_]], [[VAR_253_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_255_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_254_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_256_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_53_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_257_:%.+]] = stablehlo.add [[VAR_255_]], [[VAR_256_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_258_:%.+]] = stablehlo.logistic [[VAR_257_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_259_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_244_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_260_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_50_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_84_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_83_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_85_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_46_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_86_:%.+]] = stablehlo.add [[VAR_84_]], [[VAR_85_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_87_:%.+]] = stablehlo.tanh [[VAR_86_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_88_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_80_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_89_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_18_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_90_:%.+]] = stablehlo.multiply [[VAR_88_]], [[VAR_89_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_91_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_73_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_92_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_87_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_93_:%.+]] = stablehlo.multiply [[VAR_91_]], [[VAR_92_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_94_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_90_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_95_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_93_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_96_:%.+]] = stablehlo.add [[VAR_94_]], [[VAR_95_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_97_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_64_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_98_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_40_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_99_:%.+]] = stablehlo.add [[VAR_97_]], [[VAR_98_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_100_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_99_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_101_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_44_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_102_:%.+]] = stablehlo.add [[VAR_100_]], [[VAR_101_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_103_:%.+]] = stablehlo.logistic [[VAR_102_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_104_:%.+]] = stablehlo.tanh [[VAR_96_]] : tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_105_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_103_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_106_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_104_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_107_:%.+]] = stablehlo.multiply [[VAR_105_]], [[VAR_106_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_108_:%.+]] = stablehlo.dynamic_reshape [[VAR_107_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
+// CHECK-DAG:       [[VAR_109_:%.+]] = stablehlo.reshape [[VAR_7_]] : (tensor<1xi64>) -> tensor<i64>
+// CHECK:           [[VAR_110_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_109_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
+// CHECK:           [[VAR_111_:%.+]] = stablehlo.dynamic_reshape [[VAR_110_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
+// CHECK-DAG:       [[VAR_112_:%.+]] = stablehlo.dot [[VAR_111_]], [[VAR_31_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_113_:%.+]] = stablehlo.dot [[VAR_107_]], [[VAR_32_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_114_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_112_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_115_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_113_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK:           [[VAR_116_:%.+]] = stablehlo.add [[VAR_114_]], [[VAR_115_]] : tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_117_:%.+]] = stablehlo.dynamic_slice [[VAR_116_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_118_:%.+]] = stablehlo.dynamic_slice [[VAR_116_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_119_:%.+]] = stablehlo.dynamic_slice [[VAR_116_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_120_:%.+]] = stablehlo.dynamic_slice [[VAR_116_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_121_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_117_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_122_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_39_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_123_:%.+]] = stablehlo.add [[VAR_121_]], [[VAR_122_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_124_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_123_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_125_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_43_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_126_:%.+]] = stablehlo.add [[VAR_124_]], [[VAR_125_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_127_:%.+]] = stablehlo.logistic [[VAR_126_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_128_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_119_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_129_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_41_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_130_:%.+]] = stablehlo.add [[VAR_128_]], [[VAR_129_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_131_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_130_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_132_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_45_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_133_:%.+]] = stablehlo.add [[VAR_131_]], [[VAR_132_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_134_:%.+]] = stablehlo.logistic [[VAR_133_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_135_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_120_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_136_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_42_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_137_:%.+]] = stablehlo.add [[VAR_135_]], [[VAR_136_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_138_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_137_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_139_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_46_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_140_:%.+]] = stablehlo.add [[VAR_138_]], [[VAR_139_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_141_:%.+]] = stablehlo.tanh [[VAR_140_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_142_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_134_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_143_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_96_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_144_:%.+]] = stablehlo.multiply [[VAR_142_]], [[VAR_143_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_145_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_127_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_146_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_141_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_147_:%.+]] = stablehlo.multiply [[VAR_145_]], [[VAR_146_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_148_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_144_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_149_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_147_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_150_:%.+]] = stablehlo.add [[VAR_148_]], [[VAR_149_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_151_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_118_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_152_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_40_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_153_:%.+]] = stablehlo.add [[VAR_151_]], [[VAR_152_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_154_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_153_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_155_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_44_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_156_:%.+]] = stablehlo.add [[VAR_154_]], [[VAR_155_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_157_:%.+]] = stablehlo.logistic [[VAR_156_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_158_:%.+]] = stablehlo.tanh [[VAR_150_]] : tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_159_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_157_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_160_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_158_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_161_:%.+]] = stablehlo.multiply [[VAR_159_]], [[VAR_160_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_162_:%.+]] = stablehlo.dynamic_reshape [[VAR_161_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
+// CHECK-DAG:       [[VAR_163_:%.+]] = stablehlo.reshape [[VAR_7_]] : (tensor<1xi64>) -> tensor<i64>
+// CHECK:           [[VAR_164_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_163_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
+// CHECK:           [[VAR_165_:%.+]] = stablehlo.dynamic_reshape [[VAR_164_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
+// CHECK-DAG:       [[VAR_166_:%.+]] = stablehlo.dot [[VAR_165_]], [[VAR_33_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_167_:%.+]] = stablehlo.dot [[VAR_20_]], [[VAR_34_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_168_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_166_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_169_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_167_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK:           [[VAR_170_:%.+]] = stablehlo.add [[VAR_168_]], [[VAR_169_]] : tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_171_:%.+]] = stablehlo.dynamic_slice [[VAR_170_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_172_:%.+]] = stablehlo.dynamic_slice [[VAR_170_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_173_:%.+]] = stablehlo.dynamic_slice [[VAR_170_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_174_:%.+]] = stablehlo.dynamic_slice [[VAR_170_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_175_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_171_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_176_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_47_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_177_:%.+]] = stablehlo.add [[VAR_175_]], [[VAR_176_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_178_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_177_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_179_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_51_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_180_:%.+]] = stablehlo.add [[VAR_178_]], [[VAR_179_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_181_:%.+]] = stablehlo.logistic [[VAR_180_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_182_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_173_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_183_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_49_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_184_:%.+]] = stablehlo.add [[VAR_182_]], [[VAR_183_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_185_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_184_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_186_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_53_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_187_:%.+]] = stablehlo.add [[VAR_185_]], [[VAR_186_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_188_:%.+]] = stablehlo.logistic [[VAR_187_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_189_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_174_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_190_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_50_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_191_:%.+]] = stablehlo.add [[VAR_189_]], [[VAR_190_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_192_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_191_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_193_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_54_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_194_:%.+]] = stablehlo.add [[VAR_192_]], [[VAR_193_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_195_:%.+]] = stablehlo.tanh [[VAR_194_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_196_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_188_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_197_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_22_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_198_:%.+]] = stablehlo.multiply [[VAR_196_]], [[VAR_197_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_199_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_181_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_200_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_195_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_201_:%.+]] = stablehlo.multiply [[VAR_199_]], [[VAR_200_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_202_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_198_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_203_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_201_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_204_:%.+]] = stablehlo.add [[VAR_202_]], [[VAR_203_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_205_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_172_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_206_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_48_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_207_:%.+]] = stablehlo.add [[VAR_205_]], [[VAR_206_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_208_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_207_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_209_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_52_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_210_:%.+]] = stablehlo.add [[VAR_208_]], [[VAR_209_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_211_:%.+]] = stablehlo.logistic [[VAR_210_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_212_:%.+]] = stablehlo.tanh [[VAR_204_]] : tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_213_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_211_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_214_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_212_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_215_:%.+]] = stablehlo.multiply [[VAR_213_]], [[VAR_214_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_216_:%.+]] = stablehlo.dynamic_reshape [[VAR_215_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
+// CHECK-DAG:       [[VAR_217_:%.+]] = stablehlo.reshape [[VAR_13_]] : (tensor<1xi64>) -> tensor<i64>
+// CHECK:           [[VAR_218_:%.+]] = stablehlo.dynamic_slice [[PARAM_0_]], [[VAR_217_]], [[VAR_12_]], [[VAR_12_]], sizes = [1, 16, 512] : (tensor<2x16x512xf32>, tensor<i64>, tensor<i64>, tensor<i64>) -> tensor<1x16x512xf32>
+// CHECK:           [[VAR_219_:%.+]] = stablehlo.dynamic_reshape [[VAR_218_]], [[VAR_3_]] : (tensor<1x16x512xf32>, tensor<2xindex>) -> tensor<16x512xf32>
+// CHECK-DAG:       [[VAR_220_:%.+]] = stablehlo.dot [[VAR_219_]], [[VAR_33_]] : (tensor<16x512xf32>, tensor<512x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_221_:%.+]] = stablehlo.dot [[VAR_215_]], [[VAR_34_]] : (tensor<16x256xf32>, tensor<256x1024xf32>) -> tensor<16x1024xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_222_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_220_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_223_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_221_]], [[VAR_2_]], dims = [0, 1] : (tensor<16x1024xf32>, tensor<2xindex>) -> tensor<16x1024xf32>
+// CHECK:           [[VAR_224_:%.+]] = stablehlo.add [[VAR_222_]], [[VAR_223_]] : tensor<16x1024xf32>
+// CHECK-DAG:       [[VAR_225_:%.+]] = stablehlo.dynamic_slice [[VAR_224_]], [[VAR_12_]], [[VAR_12_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_226_:%.+]] = stablehlo.dynamic_slice [[VAR_224_]], [[VAR_12_]], [[VAR_10_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_227_:%.+]] = stablehlo.dynamic_slice [[VAR_224_]], [[VAR_12_]], [[VAR_9_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_228_:%.+]] = stablehlo.dynamic_slice [[VAR_224_]], [[VAR_12_]], [[VAR_8_]], sizes = [16, 256] : (tensor<16x1024xf32>, tensor<i64>, tensor<i64>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_229_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_225_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_230_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_47_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_231_:%.+]] = stablehlo.add [[VAR_229_]], [[VAR_230_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_232_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_231_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_233_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_51_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_234_:%.+]] = stablehlo.add [[VAR_232_]], [[VAR_233_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_235_:%.+]] = stablehlo.logistic [[VAR_234_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_236_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_227_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_237_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_49_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_238_:%.+]] = stablehlo.add [[VAR_236_]], [[VAR_237_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_239_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_238_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_240_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_53_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_241_:%.+]] = stablehlo.add [[VAR_239_]], [[VAR_240_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_242_:%.+]] = stablehlo.logistic [[VAR_241_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_243_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_228_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_244_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_50_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_245_:%.+]] = stablehlo.add [[VAR_243_]], [[VAR_244_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_246_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_245_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_247_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_54_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_248_:%.+]] = stablehlo.add [[VAR_246_]], [[VAR_247_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_249_:%.+]] = stablehlo.tanh [[VAR_248_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_250_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_242_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_251_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_204_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_252_:%.+]] = stablehlo.multiply [[VAR_250_]], [[VAR_251_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_253_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_235_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_254_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_249_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_255_:%.+]] = stablehlo.multiply [[VAR_253_]], [[VAR_254_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_256_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_252_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_257_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_255_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_258_:%.+]] = stablehlo.add [[VAR_256_]], [[VAR_257_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_259_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_226_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_260_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_48_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:           [[VAR_261_:%.+]] = stablehlo.add [[VAR_259_]], [[VAR_260_]] : tensor<16x256xf32>
 // CHECK-DAG:       [[VAR_262_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_261_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_263_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_54_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_263_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_52_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
 // CHECK:           [[VAR_264_:%.+]] = stablehlo.add [[VAR_262_]], [[VAR_263_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_265_:%.+]] = stablehlo.tanh [[VAR_264_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_266_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_258_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_267_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_216_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_268_:%.+]] = stablehlo.multiply [[VAR_266_]], [[VAR_267_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_269_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_251_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_270_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_265_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_271_:%.+]] = stablehlo.multiply [[VAR_269_]], [[VAR_270_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_272_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_268_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_273_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_271_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_274_:%.+]] = stablehlo.add [[VAR_272_]], [[VAR_273_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_275_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_242_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_276_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_48_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_277_:%.+]] = stablehlo.add [[VAR_275_]], [[VAR_276_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_278_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_277_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_279_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_52_]], [[VAR_0_]], dims = [1] : (tensor<256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_280_:%.+]] = stablehlo.add [[VAR_278_]], [[VAR_279_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_281_:%.+]] = stablehlo.logistic [[VAR_280_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_282_:%.+]] = stablehlo.tanh [[VAR_274_]] : tensor<16x256xf32>
-// CHECK-NOT: separator of consecutive DAGs
-// CHECK-DAG:       [[VAR_283_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_281_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_284_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_282_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
-// CHECK:           [[VAR_285_:%.+]] = stablehlo.multiply [[VAR_283_]], [[VAR_284_]] : tensor<16x256xf32>
-// CHECK-DAG:       [[VAR_286_:%.+]] = stablehlo.dynamic_reshape [[VAR_285_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
-// CHECK-DAG:       [[VAR_287_:%.+]] = stablehlo.concatenate [[VAR_112_]], [[VAR_170_]], dim = 0 : (tensor<1x1x16x256xf32>, tensor<1x1x16x256xf32>) -> tensor<2x1x16x256xf32>
-// CHECK:           [[VAR_288_:%.+]] = stablehlo.concatenate [[VAR_286_]], [[VAR_228_]], dim = 0 : (tensor<1x1x16x256xf32>, tensor<1x1x16x256xf32>) -> tensor<2x1x16x256xf32>
-// CHECK:           [[VAR_289_:%.+]] = stablehlo.concatenate [[VAR_287_]], [[VAR_288_]], dim = 1 : (tensor<2x1x16x256xf32>, tensor<2x1x16x256xf32>) -> tensor<2x2x16x256xf32>
-// CHECK:           return [[VAR_289_]] : tensor<2x2x16x256xf32>
+// CHECK-DAG:       [[VAR_265_:%.+]] = stablehlo.logistic [[VAR_264_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_266_:%.+]] = stablehlo.tanh [[VAR_258_]] : tensor<16x256xf32>
+// CHECK-NOT: separator of consecutive DAGs
+// CHECK-DAG:       [[VAR_267_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_265_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_268_:%.+]] = stablehlo.dynamic_broadcast_in_dim [[VAR_266_]], [[VAR_0_]], dims = [0, 1] : (tensor<16x256xf32>, tensor<2xindex>) -> tensor<16x256xf32>
+// CHECK:           [[VAR_269_:%.+]] = stablehlo.multiply [[VAR_267_]], [[VAR_268_]] : tensor<16x256xf32>
+// CHECK-DAG:       [[VAR_270_:%.+]] = stablehlo.dynamic_reshape [[VAR_269_]], [[VAR_1_]] : (tensor<16x256xf32>, tensor<4xindex>) -> tensor<1x1x16x256xf32>
+// CHECK-DAG:       [[VAR_271_:%.+]] = stablehlo.concatenate [[VAR_108_]], [[VAR_162_]], dim = 0 : (tensor<1x1x16x256xf32>, tensor<1x1x16x256xf32>) -> tensor<2x1x16x256xf32>
+// CHECK:           [[VAR_272_:%.+]] = stablehlo.concatenate [[VAR_270_]], [[VAR_216_]], dim = 0 : (tensor<1x1x16x256xf32>, tensor<1x1x16x256xf32>) -> tensor<2x1x16x256xf32>
+// CHECK:           [[VAR_273_:%.+]] = stablehlo.concatenate [[VAR_271_]], [[VAR_272_]], dim = 1 : (tensor<2x1x16x256xf32>, tensor<2x1x16x256xf32>) -> tensor<2x2x16x256xf32>
+// CHECK:           return [[VAR_273_]] : tensor<2x2x16x256xf32>
 // CHECK:         }
 }
